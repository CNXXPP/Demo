<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.dao.ExamMapper">
	<resultMap id="BaseResultMap" type="com.great.entity.Exam">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		<id column="EXAM_UUID" jdbcType="VARCHAR" property="examUuid" />
		<result column="ADM_UUID" jdbcType="VARCHAR" property="admUuid" />
		<result column="EXAM_LOCATION" jdbcType="VARCHAR" property="examLocation" />
		<result column="EXAM_DATE" jdbcType="TIMESTAMP" property="examDate" />
		<result column="EXAM_MAX_NUM" jdbcType="DECIMAL" property="examMaxNum" />
		<result column="EXAM_SUB" jdbcType="VARCHAR" property="examSub" />
		<result column="EXAM_CUR_NUM" jdbcType="DECIMAL" property="examCurNum" />
		<result column="EXAM_STATUS" jdbcType="VARCHAR" property="examStatus" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		EXAM_UUID, ADM_UUID, EXAM_LOCATION, EXAM_DATE, EXAM_MAX_NUM, EXAM_SUB,
		EXAM_CUR_NUM,
		EXAM_STATUS
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from EXAM
		where EXAM_UUID = #{examUuid,jdbcType=VARCHAR}
	</select>

	<select id="selectBySubLocTime" parameterType="java.util.Map"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from EXAM
		where EXAM_DATE = #{date,jdbcType=TIMESTAMP} and
		EXAM_LOCATION = #{loc,jdbcType=VARCHAR} and EXAM_SUB =
		#{sub,jdbcType=VARCHAR}
	</select>

	<select id="getExamStuInfo" parameterType="String" resultType="java.util.Map">
		select
		exam.exam_uuid,s.stu_id,s.stu_name,s.stu_identity,s.stu_gender,ds.sch_name,exam.exam_status,exam.exam_sub,to_char(exam.exam_date,'YYYY/MM/DD HH24:MI:SS') EXAM_DATE,exam.exam_location
		from student s
		join school_stu ss on ss.stu_uuid=s.stu_uuid join driver_school ds on
		ds.sch_uuid=ss.sch_uuid join exam_register er on
		er.stu_uuid=s.stu_uuid join exam on
		exam.exam_uuid=er.exam_uuid where exam.exam_uuid=#{examUuid,jdbcType=VARCHAR}
	</select>

	<select id="getAllExamInfo" resultType="java.util.Map">
		select
		b.exam_date,b.exam_sub,b.exam_location,b.exam_max_num,b.exam_status,c.adm_name
		from exam b join center_admin c on b.adm_uuid=c.adm_uuid
	</select>

	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		delete from EXAM
		where EXAM_UUID = #{examUuid,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.great.entity.Exam">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		insert into EXAM (EXAM_UUID, ADM_UUID, EXAM_LOCATION,
		EXAM_DATE,
		EXAM_MAX_NUM, EXAM_SUB,
		EXAM_CUR_NUM, EXAM_STATUS)
		values
		(#{examUuid,jdbcType=VARCHAR}, #{admUuid,jdbcType=VARCHAR},
		#{examLocation,jdbcType=VARCHAR},
		#{examDate,jdbcType=TIMESTAMP},
		#{examMaxNum,jdbcType=DECIMAL}, #{examSub,jdbcType=VARCHAR},
		#{examCurNum,jdbcType=DECIMAL}, #{examStatus,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.great.entity.Exam">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		insert into EXAM
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="examUuid != null">
				EXAM_UUID,
			</if>
			<if test="admUuid != null">
				ADM_UUID,
			</if>
			<if test="examLocation != null">
				EXAM_LOCATION,
			</if>
			<if test="examDate != null">
				EXAM_DATE,
			</if>
			<if test="examMaxNum != null">
				EXAM_MAX_NUM,
			</if>
			<if test="examSub != null">
				EXAM_SUB,
			</if>
			<if test="examCurNum != null">
				EXAM_CUR_NUM,
			</if>
			<if test="examStatus != null">
				EXAM_STATUS,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="examUuid != null">
				#{examUuid,jdbcType=VARCHAR},
			</if>
			<if test="admUuid != null">
				#{admUuid,jdbcType=VARCHAR},
			</if>
			<if test="examLocation != null">
				#{examLocation,jdbcType=VARCHAR},
			</if>
			<if test="examDate != null">
				#{examDate,jdbcType=TIMESTAMP},
			</if>
			<if test="examMaxNum != null">
				#{examMaxNum,jdbcType=DECIMAL},
			</if>
			<if test="examSub != null">
				#{examSub,jdbcType=VARCHAR},
			</if>
			<if test="examCurNum != null">
				#{examCurNum,jdbcType=DECIMAL},
			</if>
			<if test="examStatus != null">
				#{examStatus,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.great.entity.Exam">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		update EXAM
		<set>
			<if test="admUuid != null">
				ADM_UUID = #{admUuid,jdbcType=VARCHAR},
			</if>
			<if test="examLocation != null">
				EXAM_LOCATION = #{examLocation,jdbcType=VARCHAR},
			</if>
			<if test="examDate != null">
				EXAM_DATE = #{examDate,jdbcType=TIMESTAMP},
			</if>
			<if test="examMaxNum != null">
				EXAM_MAX_NUM = #{examMaxNum,jdbcType=DECIMAL},
			</if>
			<if test="examSub != null">
				EXAM_SUB = #{examSub,jdbcType=VARCHAR},
			</if>
			<if test="examCurNum != null">
				EXAM_CUR_NUM = #{examCurNum,jdbcType=DECIMAL},
			</if>
			<if test="examStatus != null">
				EXAM_STATUS = #{examStatus,jdbcType=VARCHAR},
			</if>
		</set>
		where EXAM_UUID = #{examUuid,jdbcType=VARCHAR}
	</update>



	<update id="updateByPrimaryKey" parameterType="com.great.entity.Exam">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Sep 26 
			17:46:16 CST 2017. -->
		update EXAM
		set ADM_UUID = #{admUuid,jdbcType=VARCHAR},
		EXAM_LOCATION =
		#{examLocation,jdbcType=VARCHAR},
		EXAM_DATE =
		#{examDate,jdbcType=TIMESTAMP},
		EXAM_MAX_NUM =
		#{examMaxNum,jdbcType=DECIMAL},
		EXAM_SUB = #{examSub,jdbcType=VARCHAR},
		EXAM_CUR_NUM = #{examCurNum,jdbcType=DECIMAL},
		EXAM_STATUS =
		#{examStatus,jdbcType=VARCHAR}
		where EXAM_UUID =
		#{examUuid,jdbcType=VARCHAR}
	</update>
	
	<select id="checkFirstExam" parameterType="com.great.entity.Exam"
		resultMap="BaseResultMap">
		SELECT * FROM EXAM WHERE EXAM_SUB=#{examSub,jdbcType=VARCHAR} AND EXAM_STATUS=#{examStatus,jdbcType=VARCHAR} 
		AND EXAM_MAX_NUM>EXAM_CUR_NUM ORDER BY EXAM_DATE
	</select>
	<update id="updateExamCurNum" parameterType="com.great.entity.ExamRegister">
        UPDATE EXAM SET EXAM_CUR_NUM=EXAM_CUR_NUM+1 WHERE EXAM_UUID=#{examUuid,jdbcType=VARCHAR}
	</update>
</mapper>